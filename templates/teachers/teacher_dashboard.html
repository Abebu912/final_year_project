{% extends 'base.html' %}
{% block title %}Teacher Dashboard{% endblock %}
{% block content %}
<div class="container py-4">
  <h2>Teacher Dashboard</h2>
  <p>Total students across your subjects: {{ total_students }}</p>
  <p>Pending scores: {{ pending_scores }}</p>
  <p>Distinct students across your subjects: {{ distinct_student_count }}</p>
  <!-- Bulk assign form -->
  <!-- Bulk assignment is handled by Registrar; teachers cannot assign subjects. -->
  <h4>Your Subjects</h4>
  <div class="list-group mb-3">
    {% for c in teacher_subjects %}
      <div class="list-group-item d-flex justify-content-between align-items-center">
        <div>
          <strong>{{ c.code }}</strong> - {{ c.name }}
          <div class="text-muted small">Students: {{ c.student_count|default:0 }}{% if c.pending_count %} • Pending: {{ c.pending_count }}{% endif %} • Sessions/week: {{ c.sessions_per_week|default:3 }}</div>
        </div>
        <div>
          <a href="{% url 'enter_grades' %}?subject_id={{ c.id }}" class="btn btn-sm btn-primary me-1">Enter Scores</a>
          <a href="{% url 'class_rosters' %}?subject_id={{ c.id }}" class="btn btn-sm btn-secondary me-1">Rosters</a>
          <a href="{% url 'performance_reports' %}?subject_id={{ c.id }}" class="btn btn-sm btn-info me-1">Reports</a>
          <a href="{% url 'bulk_grade_upload' c.id %}" class="btn btn-sm btn-outline-dark">Bulk Upload</a>
        </div>
      </div>
    {% empty %}
      <div class="list-group-item">No active subjects assigned.</div>
    {% endfor %}
  </div>
  
  <!-- Available subject claiming removed. Subject assignment is performed by the Registrar only. -->

  <h4 class="mt-4">Students Overview</h4>
  <div class="card mb-3">
    <div class="card-body">
      <h5 class="card-title">Averages & Ranks</h5>
      {% if student_ranking %}
        <table class="table table-sm">
          <thead><tr><th>Rank</th><th>Student</th><th>Average</th></tr></thead>
          <tbody>
            {% for s in student_ranking %}
              <tr>
                <td>{% if s.rank %}{{ s.rank }}{% else %}-{% endif %}</td>
                <td>{{ s.student.get_full_name }}</td>
                <td>{% if s.avg is not None %}{{ s.avg }} / 100{% else %}-{% endif %}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p>No student scores available yet.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
