{% extends 'base.html' %}
{% block title %}Class Rosters{% endblock %}
{% block content %}
<div class="container py-4">
  <h2>Class Rosters</h2>
  <form method="get" class="mb-3">
    <label for="subject">Select subject:</label>
    <select id="subject" name="subject_id" onchange="this.form.submit()">
      <option value="">--Select--</option>
      {% for c in teacher_subjects %}
      <option value="{{ c.id }}" {% if selected_subject and selected_subject.id == c.id %}selected{% endif %}>{{ c.code }} - {{ c.name }}</option>
      {% endfor %}
    </select>
  </form>

  {% if selected_subject %}
  <h4>Students in {{ selected_subject.name }}</h4>
  <table class="table">
    <thead><tr><th>Student</th><th>Current Score</th><th>Actions</th></tr></thead>
    <tbody>
      {% for en in enrollments %}
      <tr>
        <td>{{ en.student.get_full_name }}</td>
        <td>
          {% with scores=en.student.grade_set.all|dictsort:"subject__id" %}
            {% for g in en.student.grade_set.all %}
              {% if g.subject.id == selected_course.id %}
                {{ g.score }}
              {% endif %}
            {% endfor %}
          {% endwith %}
        </td>
        <td>
          <a href="/teachers/update-grade/{{ en.id }}/" class="btn btn-sm btn-primary">Update Score</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
    <p>Please select a subject to view its roster.</p>
  {% endif %}
</div>
{% endblock %}
