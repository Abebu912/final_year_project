{% extends 'base.html' %}
{% block title %}Official Transcript - {{ student.get_full_name }}{% endblock %}
{% block content %}
<div class="container py-4">
  <h2>Official Transcript</h2>
  <p><strong>{{ student.get_full_name }}</strong> • Student ID: {{ student.studentprofile.student_id }}</p>
  <p><strong>Result Average:</strong> {{ numeric_average|default:'N/A' }} / 100 • <strong>Class Rank:</strong> {{ student_rank|default:'N/A' }}</p>

  {% if transcripts_by_year %}
    {% for period, enrolls in transcripts_by_year.items %}
      <div class="card mb-3">
        <div class="card-header"><strong>{{ period }}</strong></div>
        <div class="card-body">
          <table class="table">
            <thead>
            <tr>
              <th>Subject</th>
              <th class="text-center">Result (out of 100)</th>
              <th class="text-center">Letter Grade</th>
              <th class="text-center">Rank</th>
            </tr>
            </thead>
            <tbody>
              {% for e in enrolls %}
              <tr>
                <td>{{ e.subject.name }}</td>
                <td class="text-center">
                  {% if e.numeric_score is not None %}
                    {{ e.numeric_score }}
                  {% else %}
                    N/A
                  {% endif %}
                </td>
                <td class="text-center">
                  {% if e.letter_grade %}
                    {{ e.letter_grade }}
                  {% else %}
                    {% if e.numeric_score is not None %}
                      {# derive letter from numeric #}
                      {% if e.numeric_score >= 90 %}A{% elif e.numeric_score >= 80 %}B{% elif e.numeric_score >= 70 %}C{% elif e.numeric_score >= 60 %}D{% else %}F{% endif %}
                    {% else %}
                      N/A
                    {% endif %}
                  {% endif %}
                </td>
                <td class="text-center">
                  {% if e.subject_rank %}
                    {{ e.subject_rank }}
                  {% else %}
                    -
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <p>No transcript records available.</p>
  {% endif %}

  <div class="mt-3 d-flex gap-2 align-items-center">
    <a href="{% url 'student_academic_record' student.id %}" class="btn btn-secondary ms-auto">Back</a>
  </div>
</div>
{% endblock %}
