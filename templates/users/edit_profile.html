{% extends 'base.html' %}
{% load static %}

{% block title %}Edit Profile - SIMS{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-md-10 col-lg-8">
            <div class="card shadow-lg">
                <div class="card-header bg-warning text-white">
                    <h4 class="card-title mb-0">
                        <i class="fas fa-edit me-2"></i>Edit Profile - {{ user.get_full_name|default:user.username }}
                    </h4>
                </div>
                <div class="card-body">
                    {% if messages %}
                        {% for message in messages %}
                            <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        {% endfor %}
                    {% endif %}

                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        
                        <div class="row">
                            <!-- Basic Information -->
                            <div class="col-md-8">
                                <!-- Basic Information Card -->
                                <div class="card mb-4">
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="card-title mb-0">
                                            <i class="fas fa-user me-2"></i>Basic Information
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="first_name" class="form-label fw-semibold">First Name *</label>
                                                    <input type="text" class="form-control" id="first_name" name="first_name" 
                                                           value="{{ user.first_name }}" required>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="last_name" class="form-label fw-semibold">Last Name *</label>
                                                    <input type="text" class="form-control" id="last_name" name="last_name" 
                                                           value="{{ user.last_name }}" required>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="email" class="form-label fw-semibold">Email Address *</label>
                                                    <input type="email" class="form-control" id="email" name="email" 
                                                           value="{{ user.email }}" required>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="phone" class="form-label fw-semibold">Phone Number</label>
                                                    <input type="text" class="form-control" id="phone" name="phone" 
                                                           value="{{ user.phone|default:'' }}" placeholder="Enter phone number">
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="date_of_birth" class="form-label fw-semibold">Date of Birth</label>
                                            <input type="date" class="form-control" id="date_of_birth" name="date_of_birth" 
                                                   value="{{ user.date_of_birth|date:'Y-m-d'|default:'' }}">
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="address" class="form-label fw-semibold">Address</label>
                                            <textarea class="form-control" id="address" name="address" rows="3" 
                                                      placeholder="Enter your address">{{ user.address|default:'' }}</textarea>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="profile_picture" class="form-label fw-semibold">Profile Picture</label>
                                            <input type="file" class="form-control" id="profile_picture" name="profile_picture" 
                                                   accept="image/*">
                                            {% if user.profile_picture %}
                                                <div class="mt-2">
                                                    <small class="text-muted">Current profile picture:</small>
                                                    <img src="{{ user.profile_picture.url }}" alt="Current Profile Picture" 
                                                         class="img-thumbnail mt-1" style="max-width: 100px;">
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>

                                <!-- Student-specific Fields -->
                                {% if user.role == 'student' %}
                                <div class="card mb-4">
                                    <div class="card-header bg-success text-white">
                                        <h5 class="card-title mb-0">
                                            <i class="fas fa-graduation-cap me-2"></i>Student Information
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="grade_level" class="form-label fw-semibold">Grade Level</label>
                                                    <select name="grade_level" id="grade_level" class="form-control">
                                                        <option value="">Select Grade Level</option>
                                                        {% for value, label in student_profile.GRADE_CHOICES %}
                                                            <option value="{{ value }}" 
                                                                {% if student_profile.grade_level == value %}selected{% endif %}>
                                                                {{ label }}
                                                            </option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="current_semester" class="form-label fw-semibold">Current Semester</label>
                                                    <select name="current_semester" id="current_semester" class="form-control">
                                                        <option value="">Select Semester</option>
                                                        {% for value, label in student_profile.SEMESTER_CHOICES %}
                                                            <option value="{{ value }}" 
                                                                {% if student_profile.current_semester == value %}selected{% endif %}>
                                                                {{ label }}
                                                            </option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="academic_year" class="form-label fw-semibold">Academic Year</label>
                                            <input type="text" name="academic_year" id="academic_year" class="form-control" 
                                                   placeholder="e.g., 2024-2025" value="{{ student_profile.academic_year|default:'2024-2025' }}"
                                                   pattern="\d{4}-\d{4}">
                                            <small class="form-text text-muted">Format: YYYY-YYYY (e.g., 2024-2025)</small>
                                        </div>
                                        {% if student_profile %}
                                        <div class="alert alert-info">
                                            <small>
                                                <i class="fas fa-info-circle me-1"></i>
                                                Student ID: <strong>{{ student_profile.student_id }}</strong> | 
                                                Enrollment Date: <strong>{{ student_profile.enrollment_date }}</strong>
                                            </small>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                {% endif %}

                                <!-- Teacher-specific Fields -->
                                {% if user.role == 'teacher' %}
                                <div class="card mb-4">
                                    <div class="card-header bg-warning text-white">
                                        <h5 class="card-title mb-0">
                                            <i class="fas fa-chalkboard-teacher me-2"></i>Teacher Information
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="department" class="form-label fw-semibold">Department</label>
                                            <input type="text" name="department" id="department" class="form-control" 
                                                   placeholder="e.g., Mathematics Department" 
                                                   value="{{ teacher_profile.department|default:'' }}">
                                        </div>
                                        <div class="mb-3">
                                            <label for="qualification" class="form-label fw-semibold">Qualifications</label>
                                            <textarea name="qualification" id="qualification" class="form-control" 
                                                      rows="4" placeholder="Enter your qualifications...">{{ teacher_profile.qualification|default:'' }}</textarea>
                                        </div>
                                        {% if teacher_profile %}
                                        <div class="alert alert-info">
                                            <small>
                                                <i class="fas fa-info-circle me-1"></i>
                                                Hire Date: <strong>{{ teacher_profile.hire_date }}</strong>
                                            </small>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                {% endif %}

                                <!-- Parent-specific Fields -->
                                {% if user.role == 'parent' %}
                                <div class="card mb-4">
                                    <div class="card-header bg-info text-white">
                                        <h5 class="card-title mb-0">
                                            <i class="fas fa-users me-2"></i>Parent Information
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="occupation" class="form-label fw-semibold">Occupation</label>
                                            <input type="text" name="occupation" id="occupation" class="form-control" 
                                                   placeholder="e.g., Engineer, Doctor, Business" 
                                                   value="{{ parent_profile.occupation|default:'' }}">
                                        </div>
                                        <div class="mb-3">
                                            <label for="relationship" class="form-label fw-semibold">Relationship</label>
                                            <select name="relationship" id="relationship" class="form-control">
                                                <option value="">Select Relationship</option>
                                                <option value="Father" {% if parent_profile.relationship == 'Father' %}selected{% endif %}>Father</option>
                                                <option value="Mother" {% if parent_profile.relationship == 'Mother' %}selected{% endif %}>Mother</option>
                                                <option value="Guardian" {% if parent_profile.relationship == 'Guardian' %}selected{% endif %}>Guardian</option>
                                                <option value="Other" {% if parent_profile.relationship == 'Other' %}selected{% endif %}>Other</option>
                                            </select>
                                        </div>
                                        {% if parent_profile %}
                                        <div class="alert alert-info">
                                            <small>
                                                <i class="fas fa-info-circle me-1"></i>
                                                Parent ID: <strong>{{ parent_profile.parent_id }}</strong>
                                            </small>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                {% endif %}
                            </div>

                            <!-- Actions & Help -->
                            <div class="col-md-4">
                                <div class="card mb-4">
                                    <div class="card-header bg-success text-white">
                                        <h5 class="card-title mb-0">
                                            <i class="fas fa-cog me-2"></i>Actions
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="d-grid gap-2">
                                            <button type="submit" class="btn btn-success btn-lg">
                                                <i class="fas fa-save me-2"></i>Save Changes
                                            </button>
                                            <a href="{% url 'profile' %}" class="btn btn-outline-secondary">
                                                <i class="fas fa-times me-2"></i>Cancel
                                            </a>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="card">
                                    <div class="card-header bg-light">
                                        <h6 class="card-title mb-0">
                                            <i class="fas fa-info-circle me-2"></i>Profile Information
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <small class="text-muted">
                                            <p><strong>Username:</strong> {{ user.username }}</p>
                                            <p><strong>Role:</strong> {{ user.get_role_display }}</p>
                                            <p><strong>Account Status:</strong> 
                                                <span class="badge {% if user.is_approved %}bg-success{% else %}bg-warning{% endif %}">
                                                    {% if user.is_approved %}Approved{% else %}Pending Approval{% endif %}
                                                </span>
                                            </p>
                                            <p><strong>Member Since:</strong> {{ user.date_joined|date:"M d, Y" }}</p>
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.card {
    border-radius: 0.5rem;
}

.card-header {
    border-radius: 0.5rem 0.5rem 0 0 !important;
}

.btn {
    border-radius: 0.375rem;
}

.form-control, .form-select {
    border-radius: 0.375rem;
    padding: 0.75rem 1rem;
    border: 2px solid #e9ecef;
    transition: all 0.3s ease;
}

.form-control:focus, .form-select:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
}

.badge {
    font-size: 0.75rem;
}
</style>
{% endblock %}